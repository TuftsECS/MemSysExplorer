# Profiling with Intel Perf

The **PerfProfiler** integrates the Linux `perf` tool into MemSysExplorer to collect **Hardware Performance Counter (HPC)** metrics from CPU workloads. This allows users to examine memory-level behavior and performance characteristics, such as cache hits, misses, and memory bandwidth across multiple levels of the cache hierarchy.

## Workflow Overview

The MemSysExplorer interface for `perf` supports two actions:

1. **Profiling (`profiling`)**

   * Executes the application under `perf stat`, capturing relevant cache and memory statistics.

2. **Metric Extraction (`extract_metrics`)**

   * Parses the report generated by `perf` to extract useful metrics for memory modeling.

You may also specify `both` to sequentially execute both actions.

## Supported Memory Levels

The `--level` flag defines the memory hierarchy level to analyze. The current implementation supports:

* `l1`
* `l2`
* `l3`

Each level maps to a predefined set of `perf` events selected to best approximate that layer's behavior.

## Required Arguments

The profiler interface expects the following arguments:

```python
@classmethod
def required_profiling_args(cls):
    return ["executable", "level"]

@classmethod
def required_extract_args(cls, action):
    if action == "extract_metrics":
        return ["report_file"]
    else:
        return []
```

* `--executable`: The application binary to profile.
* `--level`: One of `l1`, `l2`, or `l3` to indicate which cache level to analyze.
* `--report_file`: (For `extract_metrics`) The path to the saved `perf` output log.

## Example Usage

### Run profiling only

```bash
python main.py --profiler perf --action profiling --level l1 --executable ./your_cpu_binary
```

### Extract metrics from a previous run

```bash
python main.py --profiler perf --action extract_metrics --level l1 --report_file ./perf_output.log
```

### Perform both profiling and metric extraction

```bash
python main.py --profiler perf --action both --level l1 --executable ./your_cpu_binary
```

## Notes

* `perf` is originally designed for use on **Intel CPUs**. Accuracy and event naming may vary for other architectures.
* Some systems may restrict access to performance counters. To enable access:

  ```bash
  echo 0 | sudo tee /proc/sys/kernel/perf_event_paranoid
  ```
* You must have `perf` installed and accessible in your `PATH`.


## Troubleshooting

* **Missing perf command**: Ensure `perf` is installed. On Ubuntu, install via `sudo apt install linux-tools-common linux-tools-generic`.
* **Permission denied**: You may need to adjust kernel settings as mentioned above.
* **Incorrect level specified**: Ensure the level is one of `l1`, `l2`, or `l3`. Other levels are not supported.

## License

This profiler integrates [`perf`](https://perf.wiki.kernel.org/), the Linux performance analysis tool developed and maintained as part of the Linux kernel.

`perf` is distributed under the terms of the GNU General Public License (GPL), version 2, as specified by the Linux kernel source tree.

> Tool Homepage: [https://perf.wiki.kernel.org/](https://perf.wiki.kernel.org/)
  
